#!/usr/bin/env sh

PACKAGES_DIR="$HOME/.dotfiles/packages"
FLATPAK_APPS_FILE_PATH="$PACKAGES_DIR/flatpak-apps"
VSCODE_EXTENSIONS_FILE_PATH="$PACKAGES_DIR/vscode-extensions"
NIX_PACKAGES_FILE_PATH="$PACKAGES_DIR/nix-packages"

(set -x; flatpak list --user --columns=origin,application --app | tail -n +1 > "$FLATPAK_APPS_FILE_PATH")
(set -x; code --list-extensions > "$VSCODE_EXTENSIONS_FILE_PATH")

true > "$NIX_PACKAGES_FILE_PATH"
nix profile list | while read -r line; do
  if echo "$line" | grep -q "^Flake attribute:"; then
    (set -x; echo "$line" | awk -F ': ' '{print $2}' | sed 's/[[:space:]]//g' >> "$NIX_PACKAGES_FILE_PATH")
  fi
done
