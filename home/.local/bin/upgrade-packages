#!/usr/bin/env sh

set -ex

nix profile upgrade --all
nix profile wipe-history
nix-collect-garbage -d
mise upgrade --bump --cd "$HOME"
ubi --self-upgrade

UBI_PACKAGES="$(cat "$HOME"/.dotfiles/packages/ubi-packages)"
if [ -n "$UBI_PACKAGES" ]; then
  echo "$UBI_PACKAGES" | while read -r package; do
    # shellcheck disable=SC2086
    ubi $package --in "$HOME"/.local/bin -v
  done
fi

fish -c "fish_update_completions"
