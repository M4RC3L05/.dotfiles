#!/usr/bin/env sh

set -e

DRA_PACKAGES="$(cat "$HOME"/.dotfiles/src/packages/dra-packages)"

(
  set -x
  brew update
)
(
  set -x
  brew upgrade
)
(
  set -x
  brew cleanup
)
(
  set -x
  brew autoremove
)

(
  set -x
  mise upgrade --bump --cd "$HOME"
)

if [ -n "$DRA_PACKAGES" ]; then
  echo "$DRA_PACKAGES" | while read -r package; do
    (
      set -x
      # shellcheck disable=SC2086
      dra download $package
    )
  done
fi

(
  set -x
  fish -c "fish_update_completions"
)
