#!/usr/bin/env sh

set -e

(
  set -x
  nix profile upgrade --all
)
(
  set -x
  nix profile wipe-history
)
(
  set -x
  nix-collect-garbage -d
)

(
  set -x
  mise upgrade --bump --cd "$HOME"
)

eget M4RC3L05/denotag --upgrade-only --to "$HOME"/.local/bin/

(
  set -x
  fish -c "fish_update_completions"
)

(
  set -x
  find ~/.nix-profile/share/systemd/user/ -type l -exec sh -c 'cp -f "$(readlink -f "$0")" ~/.config/systemd/user' {} \;
)
(
  set -x
  systemctl --user daemon-reload
)
(
  set -x
  systemctl --user restart podman
)
(
  set -x
  systemctl --user restart syncthing
)

(
  set -x
  find ~/.nix-profile/share/fonts/ -type f -name "*.ttf" -exec sh -c 'cp -f "$(readlink -f "$0")" ~/.local/share/fonts' {} \;
)
(
  set -x
  fc-cache -fv
)
